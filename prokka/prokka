#!/bin/bash

# Setup env
IFLAG=false
OFLAG=false
TOOL=prokka
IMAGE=myskmadra/prokka
VERSION=1.14.1

# Define help
usage () { 
	printf "Wrapper for Prokka - rapid prokaryotic genome annotation $VERSION\\n\\nPlease specify:\n-i\tInput directory with ALL files to read\n-o\tOutput directory for the generated files to be stored\n-r\tDirectory containing reference (Optional)\n-h\tDisplay this help\n\nEXAMPLE\t\$$TOOL -i /Path/to/input -o /Path/for/output -r /Path/to/reference\n\n";
}

# Read flags
while getopts 'i:o:r:h' OPTION; do
    case $OPTION in
    i)
	IFLAG=true;
        INPUT="$OPTARG"
	;;
    o)
	OFLAG=true;
        OUTPUT="$OPTARG"
	;;
    r)
        REFERENCE="$OPTARG"
	;;
    h)
	usage;
	exit
	;;
    :)
	echo "Missing option argument for -$OPTARG" >&2;
	exit 1
	;;
    *)
        echo "Incorrect options provided";
	usage;
        exit 1
        ;;
    esac
done

# Check if required options are provided
if ! $IFLAG & ! $OFLAG; then
	echo "Please specify all options";
	usage;
	exit 1;
fi

# Display info before starting container
printf "Starting $TOOL with $INPUT as input, $OUTPUT as output and $REFERENCE as reference. Please use the directories /input (mapped to $INPUT), /output (mapped to $OUTPUT) and /reference (mapped to /reference) for your file paths.\nTo Leave $TOOL, simply call \"exit\".\n"

# Display version
sudo docker run -it --rm $IMAGE:$VERSION bash -c "prokka --version";

# Run tool in container
sudo docker run -it --rm -v $INPUT:/input -v $OUTPUT:/output -w="/input" -v $REFERENCE:/reference $IMAGE:$VERSION;
